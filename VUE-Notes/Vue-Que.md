# vue 精辟问题

## 那你能讲一讲 MVVM 吗？

- MVVM 是 Model-View-ViewModel 缩写;
- 也就是把 MVC 中的:
  - Controller 演变成 ViewModel;
- Model 层代表数据模型;
- View 代表 UI 组件;
- ViewModel 是 View 和 Model 层的桥梁;
  - 数据会绑定到 viewModel 层:
    - 并自动将数据渲染到页面中;
  - 视图变化的时候:
    - 会通知 viewModel 层更新数据;

## 简单说一下 Vue2.x 响应式数据原理

- Vue 在初始化数据时:
  - 会使用 Object.defineProperty 重新定义 data 中的所有属性;
  - 当页面使用对应属性时:
    - 首先会进行依赖收集;
    - 收集当前组件的 watcher;
    - 如果属性发生变化:
      - 会通知相关依赖进行更新操作(发布订阅);

## 那你知道 Vue3.x 响应式数据原理吗?

- Vue3.x 改用 Proxy 替代 Object.defineProperty;
- 因为 Proxy 可以直接监听'对象'和'数组'的变化;
  - 并且有多达 13 种拦截方法;
- 并且作为新标准:
  - 将受到'浏览器厂商'重点持续的性能优化;

### Proxy 只会代理对象的第一层，那么 Vue3 又是怎样处理这个问题的呢？

- 判断当前 Reflect.get 的返回值是否为 Object;
  - 如果是则再通过 reactive 方法做代理;
  - 这样就实现了深度观测;

### 监测数组的时候可能触发多次 get/set，那么如何防止触发多次呢？

- 我们可以判断 key 是否为:
  - 当前被代理对象 target 自身属性;
- 也可以判断'旧值'与'新值'是否相等;
  - 只有满足以上两个条件之一时:
    - 才有可能执行 trigger;

## 再说一下vue2.x中如何监测数组变化

- 使用了函数劫持的方式:
    - 重写了数组的方法;
- Vue将data中的数组进行了原型链重写;
    - 指向了自己定义的数组原型方法;
- 这样当调用数组api时，可以通知依赖更新;
- 如果数组中包含着引用类型:
    - 会对数组中的'引用类型'再次'递归遍历'进行监控;
- 这样就实现了监测数组变化;
